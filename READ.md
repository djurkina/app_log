# Google Drive Manager

Это приложение позволяет управлять файлами и папками Google Drive посредством рекурсивного копирования и автоматического мониторинга папок для копирования новых файлов и подпапок. Дополнительно, приложение предоставляет возможность отменить все выполненные операции (то есть удалить все объекты, скопированные через процесс AddMonitor) с подробным логированием каждой операции удаления.

## Функциональность

- **Copy**: Рекурсивное копирование файлов и подпапок из одной папки в другую.
- **Monitor / AddMonitor / RemoveMonitor**: Создание и удаление задач мониторинга для автоматического копирования новых объектов (файлов и подпапок) из исходной папки.
- **Report**: Отображение полного отчёта изменений (журнал операций) с подробными данными.
- **SetPermissions**: Изменение прав доступа для файлов и папок.
- **Cancel All Operations**: Удаление всех объектов, скопированных через AddMonitor, и очистка списка задач мониторинга. При выполнении данной операции в лог выводятся подробные сообщения о том, какие задачи и объекты удаляются.

## Структура проекта

project/ ├── config.py # Конфигурация (путь к файлу сервисного аккаунта и ID корневой папки Google Drive) ├── drive_service.py # Модуль для работы с API Google Drive (поддерживает общие диски и рекурсивное копирование) ├── gui.py # Графический интерфейс приложения ├── monitor_tasks.json # Файл для хранения задач мониторинга (относительные пути и ID скопированных объектов) ├── changes_log.json # Файл для хранения журнала изменений ├── requirements.txt # Список зависимостей └── read.md # Это описание проекта

markdown
نسخ

## Установка

1. **Клонирование проекта**  
   Склонируйте репозиторий или скачайте исходный код и разместите его в выбранной вами директории.

2. **Установка зависимостей**  
   Установите все необходимые пакеты, используя команду:
   ```bash
   pip install -r requirements.txt
Настройка Google Drive API

Создайте проект в Google Cloud Console.

Включите API Google Drive через раздел APIs & Services → Library.

Создайте сервисный аккаунт:

Перейдите в APIs & Services → Credentials.

Нажмите кнопку «Создать учетные данные» и выберите «Сервисный аккаунт».

Заполните необходимые данные и назначьте соответствующую роль (например, Editor).

После создания перейдите на вкладку Ключи и создайте новый ключ в формате JSON.

Переименуйте скачанный файл в credentials.json и поместите его в корневую папку проекта.

Настройка параметров
Откройте файл config.py и убедитесь, что параметр GOOGLE_ROOT_ID установлен правильно (по умолчанию используется "root").

Запуск приложения
Для запуска приложения выполните команду:

bash
نسخ
python gui.py
После этого откроется окно графического интерфейса с кнопками для различных операций:

Copy – рекурсивное копирование всех файлов и подпапок из исходной папки в целевую.

Monitor / AddMonitor / RemoveMonitor – создание и удаление задач мониторинга для автоматического копирования новых объектов.

Report – вывод детального отчёта изменений.

SetPermissions – изменение прав доступа для выбранных объектов.

Cancel All Operations – отмена всех выполненных операций (удаление скопированных объектов и очистка списка задач мониторинга) с подробным логированием.

Использование
Copy
Введите URL исходной и целевой папок. Приложение выполнит рекурсивное копирование и выведет в лог общее количество скопированных объектов.

AddMonitor
Приложение выполнит первичное копирование и создаст задачу мониторинга для дальнейшего автоматического копирования новых объектов. Если задача для указанных папок уже создана, повторное создание не происходит.

RemoveMonitor
Позволяет удалить заданную задачу мониторинга по указанным URL папок.

Report
Открывается окно с полным логом изменений, содержащим время, тип операции и сведения о файлах/папках.

SetPermissions
Позволяет изменить права доступа для файла или папки, запросив URL объекта, адрес электронной почты и требуемую роль (reader, writer, owner).

Cancel All Operations
Удаляет все объекты, которые были скопированы через AddMonitor, и очищает список задач мониторинга. При этом приложение выводит в лог подробную информацию о том, какие именно объекты и задачи мониторинга отменяются. Важно: если в monitor_tasks.json сохранены некорректные ID, для них выполняется дополнительная проверка, и такие объекты пропускаются.

Замечания
Файлы данных:
Если файлы monitor_tasks.json или changes_log.json отсутствуют, они будут созданы автоматически при первом запуске приложения.

Обработка ошибок:
Приложение использует библиотеку tenacity для повторных попыток выполнения операций (retry). Если какая-либо операция не удаётся, подробные сообщения об ошибках выводятся в лог.

Права доступа:
Убедитесь, что сервисный аккаунт имеет достаточные права для выполнения операций с файлами и папками. Папки, с которыми вы работаете, должны быть поделены с email сервисного аккаунта. Для общих дисков также убедитесь, что у аккаунта назначена корректная роль (например, Content Manager или Editor).

Некорректные ID:
Если функция копирования сохранила неверные ID для некоторых файлов, отмена операций будет пропускать их, выводя в лог сообщение об ошибке. Лучше всего обеспечить корректное сохранение ID при копировании.

Альтернативный откат:
Если в уже созданных задачах мониторинга сохранены неправильные ID, можно реализовать механизм поиска объектов по именам и относительному пути в целевой папке для их удаления. Это потребует дополнительной логики, поэтому рекомендуется корректно настраивать копирование с сохранением реальных ID.

Google API и сервисный аккаунт
Для получения дополнительной информации о настройке Google Drive API и сервисных аккаунтов, ознакомьтесь с документацией Google Developers.
